
        AREA    |Test$$Code|, CODE

        GET     hdr.swis
        GET     hdr.printmacros
        GET     hdr.macros
        GET     hdr.vdu


MaxMode * 50

vdu_mode     ROUT
        Push    "r1, lr"

        PrintLine "--- ReadModeVariables"

        BL      modelist_headings

        MOV     r8, r1
        LDRB    r0, [r8]
        ADR     lr, %FT90
        CMP     r0, #32
        BLT     show_all
        B       show_numbered
90
        Pull    "r1, pc"


; Just show the numbered modes supplied
show_numbered SIGNATURE
        Push    "r1, lr"

20
        XSWI    XOS_ReadUnsigned, #10, r8
        MOV     r8, r1
        MOV     r0, r2
        BL      modelist_variables
        LDRB    r0, [r8], #1
        TEQ     r0, #32
        BEQ     %BT20

        Pull    "r1, pc"


; Show all the modes (0-MaxMode)
show_all SIGNATURE
        Push    "r1, lr"

        MOV     r0, #0
10
        BL      modelist_variables
        ADD     r0, r0, #1
        CMP     r0, #MaxMode
        BLE     %BT10

; Now test what happens if we read an invalid variable
        XSWI    XOS_ReadModeVariable, 64
        ADRVC   r0, badvar_ok
        ADRVS   r0, badvar_bad
        SWI     XOS_Write0
        SWI     XOS_NewLine

        Pull    "r1, pc"

badvar_ok
        = "Reading an invalid variable was ok", 0
badvar_bad
        = "Error: Reading an invalid variable didn't generate an error", 0
        ALIGN

        GET     s._mode_common


        END
